<!DOCTYPE html>
<html lang="sk">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>GeoDash Pro - Music & Victory</title>
    <style>
        :root { --primary: #00f2ff; }
        body { margin: 0; overflow: hidden; font-family: 'Arial Black', sans-serif; background: #0a0a0a; color: white; }
        
        #ui-layer { position: absolute; width: 100%; height: 100%; display: flex; flex-direction: column; align-items: center; justify-content: center; background: rgba(0,0,0,0.7); z-index: 10; }
        .hidden { display: none !important; }
        
        h1 { font-size: 80px; margin: 0; color: var(--primary); text-shadow: 0 0 20px var(--primary); font-style: italic; }
        .panel { background: rgba(255,255,255,0.1); padding: 30px; border-radius: 20px; backdrop-filter: blur(10px); border: 2px solid var(--primary); text-align: center; width: 400px; }
        
        .btn-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 10px; margin-top: 20px; }
        button { padding: 15px; cursor: pointer; background: var(--primary); border: none; color: black; border-radius: 8px; font-weight: bold; text-transform: uppercase; transition: 0.3s; }
        button:hover { transform: scale(1.05); box-shadow: 0 0 15px var(--primary); }

        .victory-text { font-size: 60px; color: #00ff00; text-shadow: 0 0 20px #00ff00; display: none; position: absolute; top: 30%; z-index: 20; }
        
        #progress-bar { position: absolute; top: 20px; width: 300px; height: 10px; background: rgba(255,255,255,0.2); border-radius: 5px; overflow: hidden; }
        #progress-fill { width: 0%; height: 100%; background: var(--primary); box-shadow: 0 0 10px var(--primary); transition: 0.1s; }

        canvas { display: block; }
    </style>
</head>
<body>

    <div id="progress-bar"><div id="progress-fill"></div></div>
    <div id="victory-screen" class="victory-text">LEVEL COMPLETE!</div>

    <div id="ui-layer">
        <h1>GEODASH</h1>
        <div class="panel">
            <p>Vyber si farbu a level:</p>
            <input type="color" id="pColor" value="#00f2ff" style="width:100%; height:40px; border:none; background:none; cursor:pointer;">
            <div class="btn-grid">
                <button onclick="startGame('level1')">Level 1 (Easy)</button>
                <button onclick="startGame('level2')">Level 2</button>
                <button onclick="startGame('level3')">Level 3</button>
                <button onclick="startGame('endless')" style="grid-column: span 2; background: #ffcc00;">Endless Mode</button>
            </div>
        </div>
    </div>

    <canvas id="gameCanvas"></canvas>

    <script>
        const canvas = document.getElementById('gameCanvas');
        const ctx = canvas.getContext('2d');
        const uiLayer = document.getElementById('ui-layer');
        const victoryText = document.getElementById('victory-screen');
        const progressFill = document.getElementById('progress-fill');

        canvas.width = window.innerWidth;
        canvas.height = window.innerHeight;

        // --- HUDBA ---
        // Tu môžeš vymeniť URL za svoje pesničky
        const music = new Audio('https://www.soundhelix.com/examples/mp3/SoundHelix-Song-1.mp3');
        music.loop = true;

        let gameState = 'menu';
        let currentLevel = null;
        let distance = 0;
        let speed = 8;
        let isHoldingJump = false;
        let pColor = "#00f2ff";
        
        let bgColor = { r: 20, g: 20, b: 35 };
        const groundY = canvas.height * 0.75;

        let player = {
            x: 150, y: groundY - 50, size: 50,
            vy: 0, rotation: 0, isJumping: false
        };

        let obstacles = [];

        const levels = {
            level1: { 
                obstacles: [1000, 2000, 3000, 4000, 5000, 6000], // Ľahký level, veľké medzery
                color: [0, 150, 255], end: 7000 
            },
            level2: { 
                obstacles: [800, 1100, 1400, 1700, 2000, 2100, 2500, 2800, 3200, 3500, 3800, 4200, 4500, 4800], 
                color: [46, 204, 113], end: 5500 
            },
            level3: { 
                obstacles: [800, 950, 1100, 1400, 1550, 1700, 2000, 2100, 2200, 2600, 2800, 3000, 3300, 3600, 3900, 4000], 
                color: [231, 76, 60], end: 5000 
            }
        };

        function startGame(mode) {
            pColor = document.getElementById('pColor').value;
            gameState = 'playing';
            currentLevel = mode;
            uiLayer.classList.add('hidden');
            victoryText.style.display = 'none';
            
            // Spustiť hudbu
            music.currentTime = 0;
            music.play().catch(e => console.log("Hudba čaká na interakciu"));
            
            resetGame();
        }

        function resetGame() {
            distance = 0;
            player.y = groundY - 50;
            player.vy = 0;
            player.rotation = 0;
            obstacles = [];
            
            if(currentLevel !== 'endless') {
                levels[currentLevel].obstacles.forEach(ox => {
                    obstacles.push({ x: ox });
                });
            }
        }

        function drawCube(x, y, size, rot) {
            ctx.save();
            ctx.translate(x + size/2, y + size/2);
            ctx.rotate(rot * Math.PI / 180);
            ctx.fillStyle = pColor;
            ctx.shadowBlur = 15;
            ctx.shadowColor = pColor;
            ctx.fillRect(-size/2, -size/2, size, size);
            ctx.strokeStyle = "white";
            ctx.lineWidth = 2;
            ctx.strokeRect(-size/2 + 5, -size/2 + 5, size-10, size-10);
            ctx.restore();
            ctx.shadowBlur = 0;
        }

        function drawSpike(x, y, size) {
            ctx.fillStyle = "#333";
            ctx.strokeStyle = "#ff4444";
            ctx.lineWidth = 3;
            ctx.beginPath();
            ctx.moveTo(x, y);
            ctx.lineTo(x + size, y);
            ctx.lineTo(x + size/2, y - size);
            ctx.closePath();
            ctx.fill();
            ctx.stroke();
        }

        function update() {
            if(gameState !== 'playing') return;

            distance += speed;

            // Auto-jump
            if(isHoldingJump && !player.isJumping) {
                player.vy = -15;
                player.isJumping = true;
            }

            player.vy += 0.9;
            player.y += player.vy;

            if(player.y > groundY - player.size) {
                player.y = groundY - player.size;
                player.vy = 0;
                player.isJumping = false;
                player.rotation = Math.round(player.rotation / 90) * 90;
            }

            if(player.isJumping) player.rotation += 5;

            // Kontrola konca levelu
            if(currentLevel !== 'endless') {
                let progress = (distance / levels[currentLevel].end) * 100;
                progressFill.style.width = Math.min(progress, 100) + "%";

                if(distance > levels[currentLevel].end) {
                    gameState = 'victory';
                    music.pause();
                    victoryText.style.display = 'block';
                    setTimeout(() => {
                        uiLayer.classList.remove('hidden');
                        victoryText.style.display = 'none';
                    }, 3000);
                }
            }
        }

        function draw() {
            // Pozadie
            ctx.fillStyle = `rgb(${bgColor.r}, ${bgColor.g}, ${bgColor.b})`;
            ctx.fillRect(0, 0, canvas.width, canvas.height);

            // Zem
            ctx.fillStyle = "#111";
            ctx.fillRect(0, groundY, canvas.width, canvas.height - groundY);
            ctx.strokeStyle = pColor;
            ctx.strokeRect(-10, groundY, canvas.width + 20, 5);

            if(gameState === 'playing' || gameState === 'victory') {
                drawCube(player.x, player.y, player.size, player.rotation);

                obstacles.forEach(obs => {
                    let screenX = obs.x - distance + 400;
                    drawSpike(screenX, groundY, 50);

                    // Kolízia
                    if(screenX < player.x + 40 && screenX + 40 > player.x && player.y + 40 > groundY - 40) {
                        music.pause();
                        gameState = 'menu';
                        uiLayer.classList.remove('hidden');
                        alert("CRASH! Skús to znova.");
                    }
                });

                // Cieľová čiara
                if(currentLevel !== 'endless') {
                    let finishX = levels[currentLevel].end - distance + 400;
                    ctx.fillStyle = "rgba(255,255,255,0.5)";
                    ctx.fillRect(finishX, 0, 50, groundY);
                    ctx.strokeStyle = "white";
                    ctx.lineWidth = 5;
                    ctx.strokeRect(finishX, 0, 50, groundY);
                }
            } else {
                // Menu animácia
                drawCube(canvas.width/2 - 25, groundY - 50, 50, distance);
            }

            update();
            requestAnimationFrame(draw);
        }

        // Ovládanie
        window.addEventListener('keydown', (e) => { if(e.code === 'Space' || e.code === 'ArrowUp') isHoldingJump = true; });
        window.addEventListener('keyup', (e) => { if(e.code === 'Space' || e.code === 'ArrowUp') isHoldingJump = false; });
        window.addEventListener('mousedown', () => isHoldingJump = true);
        window.addEventListener('mouseup', () => isHoldingJump = false);

        draw();
    </script>
</body>
</html>
